<head>
  <script>
(function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:5149731,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script>
</head>

<div [ngClass]="{'blur-background': showCardInsertionPopup}">
  <h5 class="text-md-center m-5">Purchase Flight</h5>

  <div class="card-body text-center" style="padding: 20px; background-color:#e5ecf26e">
    <h6 class="card-title ">{{ flight.airline }}</h6>
    <div class="card-title" style="color: #ff3939">{{ flight.remainingNumberOfSeats }} remaining seats</div>
    <div class="d-grid text-center g-2">
      <div class="row">
        <div class="col">
          <div class="col m-3">
            <i class="text-primary fas fa-plane-departure" style="font-size: 20px;"></i>
          </div>
          <div class="col">
            <i class="fa-solid fa-location-dot">
              {{ flight.departure?.place }}
            </i>
          </div>
          <div class="col m-2">
            <i class="fa-regular"></i>
            {{ flight.departure?.time | date }}
          </div>
          <div class="col">
            <i class="fa-regular fa-clock">
              {{ flight.departure?.time | date:'shortTime' }}
            </i>
          </div>
        </div>
        <div class="col">
          <div style="display: flex;">
            <i class="fa-solid fa-circle" style="margin-top:51px; font-size: 9px;"></i>
            <hr style="display:block;width: 100%;margin-top: 55px;">
            <i class="fas fa-plane" style="margin-top: 48px;"></i>
          </div>
          <div *ngIf="getDiscountedPrice(flight.price) !== null">
            <span style="text-decoration: line-through; font-weight: 100; font-size: 14px;">$ {{ flight.price }}</span><br>
            <span style="font-weight: bolder; font-size: 18px; ">$ {{ getDiscountedPrice(flight.price) }}</span>
          </div>
          <div *ngIf="getDiscountedPrice(flight.price) === null">
            <span>$ {{ flight.price }}</span>
          </div>
          <br />
        </div>
        <div class="col">
          <div class="col m-3">
            <i class="text-primary fas fa-plane-arrival" style="font-size: 20px;"></i>
          </div>
          <div class="col">
            <i class="fa-solid fa-location-dot">
              {{ flight.arrival?.place }}
            </i>
          </div>
          <div class="col m-2 text-primary">
            <i class="fa-regular "></i>
            {{ flight.arrival?.time | date }}
          </div>
          <div class="col">
            <i class="fa-regular fa-clock">
              {{ flight.arrival?.time | date:'shortTime' }}
            </i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card-footer d-flex justify-content-center">
    <form [formGroup]="form" (ngSubmit)="purchase(flight)">
      <label class="form-label mt-5" for="numberOfSeats">Number of Seats</label>
      <div class="center input-group">
        <input formControlName="number" type="number" class="form-control" id="numberOfSeats" name="numberOfSeats"
               placeholder="Number of Seats" />
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-ticket"></i>
          Purchase
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="number?.invalid && (number?.dirty || number?.touched)" class="invalid-feedback d-block">
    <div *ngIf="number?.errors?.['required']">
      How many people do you want to Purchase the flight for?
    </div>
    <div *ngIf="number?.errors?.['min']">
      You can not Purchase for less than 1 passenger!
    </div>
    <div *ngIf="number?.errors?.['max']">
      Our planes do not have more than 10 seats.
    </div>
  </div>
</div>

<div *ngIf="showCardInsertionPopup" class="popup-overlay">
  <div class="card-insertion-popup">
    <h5>Enter Card Details</h5>
    <p>Total Payment: {{ paymentAmount | currency }}</p>
    <div class="form-group">
      <label for="cardNumber">Card Number</label>
      <input type="text" id="cardNumber" class="form-control" placeholder="Enter card number" [(ngModel)]="cardNumber" required>
      <div class="invalid-feedback" *ngIf="cardNumberInvalid">
        Please enter a valid card number.
      </div>
    </div>
    <div class="form-group">
      <label for="expiryDate">Expiry Date</label>
      <input type="text" id="expiryDate" class="form-control" placeholder="MM/YY" [(ngModel)]="expiryDate" required>
    </div>
    <div class="form-group">
      <label for="cvv">CVV</label>
      <input type="text" id="cvv" class="form-control" placeholder="CVV" [(ngModel)]="cvv" required>
    </div>
    <div class="form-group text-center">
      <button class="btn btn-primary" (click)="buyTickets()">Buy Tickets</button>
      <button class="btn btn-secondary" (click)="closePopup()">Cancel</button>
    </div>
  </div>
</div>
<div *ngIf="showErrorMessage" class="alert alert-danger mt-3" style="text-align: center;">
  We encountered a technical issue while processing your request. Please try again later.
</div>
