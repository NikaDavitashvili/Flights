{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../api/services/booking.service\";\nimport * as i2 from \"../auth/auth.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common\";\nfunction MyBookingsComponent_div_3_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"span\", 31);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"br\");\n    i0.ɵɵelementStart(4, \"span\", 32);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const booking_r2 = i0.ɵɵnextContext().$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$ \", booking_r2.price, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"$ \", ctx_r3.getDiscountedPrice(booking_r2.price), \"\");\n  }\n}\nfunction MyBookingsComponent_div_3_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const booking_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$ \", booking_r2.price, \"\");\n  }\n}\nfunction MyBookingsComponent_div_3_div_52_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" You cannot Return for less than 1 passenger! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MyBookingsComponent_div_3_div_52_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Our planes do not have more than 10 seats. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MyBookingsComponent_div_3_div_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33);\n    i0.ɵɵtemplate(1, MyBookingsComponent_div_3_div_52_div_1_Template, 2, 0, \"div\", 20);\n    i0.ɵɵtemplate(2, MyBookingsComponent_div_3_div_52_div_2_Template, 2, 0, \"div\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    let tmp_0_0;\n    let tmp_1_0;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (tmp_0_0 = ctx_r5.form.get(\"number\")) == null ? null : tmp_0_0.errors == null ? null : tmp_0_0.errors[\"min\"]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (tmp_1_0 = ctx_r5.form.get(\"number\")) == null ? null : tmp_1_0.errors == null ? null : tmp_1_0.errors[\"max\"]);\n  }\n}\nfunction MyBookingsComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 4)(2, \"h6\", 5);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 6);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 7)(7, \"div\", 8)(8, \"div\", 9)(9, \"div\", 10);\n    i0.ɵɵelement(10, \"i\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 9)(12, \"i\", 12);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(14, \"div\", 13)(15, \"i\", 14);\n    i0.ɵɵtext(16);\n    i0.ɵɵpipe(17, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 9)(19, \"i\", 15);\n    i0.ɵɵtext(20);\n    i0.ɵɵpipe(21, \"date\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(22, \"div\", 9)(23, \"div\", 16);\n    i0.ɵɵelement(24, \"i\", 17)(25, \"hr\", 18)(26, \"i\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, MyBookingsComponent_div_3_div_27_Template, 6, 2, \"div\", 20);\n    i0.ɵɵtemplate(28, MyBookingsComponent_div_3_div_28_Template, 3, 1, \"div\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 9)(30, \"div\", 10);\n    i0.ɵɵelement(31, \"i\", 21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"div\", 9)(33, \"i\", 12);\n    i0.ɵɵtext(34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 22)(36, \"i\", 14);\n    i0.ɵɵtext(37);\n    i0.ɵɵpipe(38, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(39, \"div\", 9)(40, \"i\", 15);\n    i0.ɵɵtext(41);\n    i0.ɵɵpipe(42, \"date\");\n    i0.ɵɵelementEnd()()()()()();\n    i0.ɵɵelementStart(43, \"div\", 23)(44, \"form\", 24)(45, \"label\", 25);\n    i0.ɵɵtext(46, \"Number of Seats\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(47, \"div\", 26);\n    i0.ɵɵelement(48, \"input\", 27);\n    i0.ɵɵelementStart(49, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function MyBookingsComponent_div_3_Template_button_click_49_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const booking_r2 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.openReturnPopup(booking_r2);\n    });\n    i0.ɵɵelement(50, \"i\", 29);\n    i0.ɵɵtext(51, \" Return Tickets \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(52, MyBookingsComponent_div_3_div_52_Template, 3, 2, \"div\", 30);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const booking_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    let tmp_11_0;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(booking_r2.airline);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", booking_r2.numberOfBookedSeats, \" booked seat(s)\");\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate(booking_r2.departure == null ? null : booking_r2.departure.place);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(17, 12, booking_r2.departure == null ? null : booking_r2.departure.time));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(21, 14, booking_r2.departure == null ? null : booking_r2.departure.time, \"shortTime\"));\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.getDiscountedPrice(booking_r2.price) !== null);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.getDiscountedPrice(booking_r2.price) === null);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(booking_r2.arrival == null ? null : booking_r2.arrival.place);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(38, 17, booking_r2.arrival == null ? null : booking_r2.arrival.time));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(42, 19, booking_r2.arrival == null ? null : booking_r2.arrival.time, \"shortTime\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.form);\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_11_0 = ctx_r0.form.get(\"number\")) == null ? null : tmp_11_0.invalid) && (((tmp_11_0 = ctx_r0.form.get(\"number\")) == null ? null : tmp_11_0.dirty) || ((tmp_11_0 = ctx_r0.form.get(\"number\")) == null ? null : tmp_11_0.touched)));\n  }\n}\nfunction MyBookingsComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 34)(1, \"div\", 35)(2, \"h5\");\n    i0.ɵɵtext(3, \"Return Tickets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"h5\");\n    i0.ɵɵtext(8, \"Enter Card Details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 36)(10, \"label\", 37);\n    i0.ɵɵtext(11, \"Card Number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"input\", 38);\n    i0.ɵɵelementStart(13, \"div\", 39);\n    i0.ɵɵtext(14, \" Please enter a valid card number. \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"div\", 36)(16, \"label\", 40);\n    i0.ɵɵtext(17, \"Expiry Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 41);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 36)(20, \"label\", 42);\n    i0.ɵɵtext(21, \"CVV\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(22, \"input\", 43);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"div\", 44)(24, \"button\", 45);\n    i0.ɵɵlistener(\"click\", function MyBookingsComponent_div_4_Template_button_click_24_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.cancel();\n    });\n    i0.ɵɵtext(25, \"Return Tickets\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"button\", 46);\n    i0.ɵɵlistener(\"click\", function MyBookingsComponent_div_4_Template_button_click_26_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.closeReturnPopup();\n    });\n    i0.ɵɵtext(27, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"You will be refunded: \", i0.ɵɵpipeBind1(6, 1, ctx_r1.returnAmount), \"\");\n  }\n}\nexport let MyBookingsComponent = /*#__PURE__*/(() => {\n  class MyBookingsComponent {\n    constructor(bookingService, authService, formBuilder) {\n      this.bookingService = bookingService;\n      this.authService = authService;\n      this.formBuilder = formBuilder;\n      this.bookings = [];\n      this.currentUser = null;\n      this.showReturnPopup = false;\n      this.currentBooking = null;\n      this.returnAmount = 0;\n      this.cancelPercent = 0;\n      this.seasonName = null;\n      this.numberOfTickets = 1;\n    }\n    ngOnInit() {\n      this.loadBookings();\n      this.initializeForm();\n      const userJson = sessionStorage.getItem('CurrentUser');\n      if (userJson) {\n        this.currentUser = JSON.parse(userJson);\n      }\n    }\n    loadBookings() {\n      var _a, _b;\n      this.bookingService.listBooking({\n        email: (_b = (_a = this.authService.currentUser) === null || _a === void 0 ? void 0 : _a.email) !== null && _b !== void 0 ? _b : ''\n      }).subscribe(bookings => {\n        this.bookings = bookings;\n      }, error => {\n        this.handleError(error);\n      });\n    }\n    initializeForm() {\n      this.form = this.formBuilder.group({\n        number: ['', [Validators.required, Validators.min(1), Validators.max(10)]]\n      });\n    }\n    handleError(err) {\n      console.error('Response Error, Status:', err.status);\n      console.error('Response Error, Status Text:', err.statusText);\n      console.error(err);\n    }\n    openReturnPopup(booking) {\n      var _a;\n      const numberOfTickets = (_a = this.form.get('number')) === null || _a === void 0 ? void 0 : _a.value;\n      if (numberOfTickets <= 0) {\n        alert('Please enter a valid number of tickets to cancel.');\n        return;\n      }\n      this.currentBooking = booking;\n      if (numberOfTickets > booking.numberOfBookedSeats) {\n        alert('You can not return more tickets that you have purchased.');\n        return;\n      }\n      const userJson = sessionStorage.getItem('CurrentUser');\n      if (userJson) {\n        const user = JSON.parse(userJson);\n        this.cancelPercent = user.cancelpercent / 100;\n      }\n      this.numberOfTickets = numberOfTickets;\n      this.showReturnPopup = true;\n      document.body.classList.add('no-scroll');\n    }\n    closeReturnPopup() {\n      this.showReturnPopup = false;\n      this.currentBooking = null;\n      document.body.classList.remove('no-scroll');\n    }\n    cancel() {\n      var _a;\n      const booking = this.currentBooking;\n      const numberOfTickets = (_a = this.form.get('number')) === null || _a === void 0 ? void 0 : _a.value;\n      if (!booking) {\n        alert('Invalid booking!');\n        return;\n      }\n      if (numberOfTickets <= 0) {\n        alert('Please enter a valid number of tickets to cancel.');\n        return;\n      }\n      const dto = {\n        flightId: booking.flightId,\n        numberOfSeats: numberOfTickets,\n        passengerEmail: booking.passengerEmail\n      };\n      this.bookingService.cancelBooking({\n        body: dto\n      }).subscribe(_ => {\n        // Remove the canceled booking from the local list\n        this.bookings = this.bookings.filter(b => b !== booking);\n        this.loadBookings();\n        this.closeReturnPopup();\n      }, error => {\n        this.handleError(error);\n      });\n    }\n    getDiscountedPrice(price) {\n      this.seasonName = sessionStorage.getItem('SeasonName');\n      var seasonDiscountedPrice = 0;\n      if (this.currentUser && this.currentUser.packetid !== 1) {\n        var discountedPrice = price * (1 - this.currentUser.purchasepercent / 100);\n        this.returnAmount = discountedPrice * (this.currentUser.cancelpercent / 100) * this.numberOfTickets;\n        if (this.seasonName === 'Summer') seasonDiscountedPrice = discountedPrice * 0.85;else seasonDiscountedPrice = discountedPrice * 0.90;\n        //this.currentBooking!.price = discountedPrice.toString();\n      } else {\n        if (this.seasonName === 'Summer') seasonDiscountedPrice = price * 0.85;else seasonDiscountedPrice = price * 0.90;\n      }\n      return Math.round(seasonDiscountedPrice);\n    }\n  }\n  MyBookingsComponent.ɵfac = function MyBookingsComponent_Factory(t) {\n    return new (t || MyBookingsComponent)(i0.ɵɵdirectiveInject(i1.BookingService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.FormBuilder));\n  };\n  MyBookingsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: MyBookingsComponent,\n    selectors: [[\"app-my-bookings\"]],\n    decls: 5,\n    vars: 2,\n    consts: [[1, \"text-md-center\", \"m-5\"], [\"class\", \"card bg-light text-dark mt-5\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"popup-overlay\", 4, \"ngIf\"], [1, \"card\", \"bg-light\", \"text-dark\", \"mt-5\"], [1, \"card-body\", \"text-center\", 2, \"padding\", \"20px\", \"background-color\", \"#e5ecf26e\"], [1, \"card-title\"], [1, \"card-title\", 2, \"color\", \"#ff3939\"], [1, \"d-grid\", \"text-center\", \"g-2\"], [1, \"row\"], [1, \"col\"], [1, \"col\", \"m-3\"], [1, \"text-primary\", \"fas\", \"fa-plane-departure\", 2, \"font-size\", \"20px\"], [1, \"fa-solid\", \"fa-location-dot\"], [1, \"col\", \"m-2\"], [1, \"fa-regular\"], [1, \"fa-regular\", \"fa-clock\"], [2, \"display\", \"flex\"], [1, \"fa-solid\", \"fa-circle\", 2, \"margin-top\", \"51px\", \"font-size\", \"9px\"], [2, \"display\", \"block\", \"width\", \"100%\", \"margin-top\", \"55px\"], [1, \"fas\", \"fa-plane\", 2, \"margin-top\", \"48px\"], [4, \"ngIf\"], [1, \"text-primary\", \"fas\", \"fa-plane-arrival\", 2, \"font-size\", \"20px\"], [1, \"col\", \"m-2\", \"text-primary\"], [1, \"card-footer\", \"d-flex\", \"justify-content-center\"], [3, \"formGroup\"], [\"for\", \"numberOfSeats\", 1, \"form-label\", \"mt-5\"], [1, \"center\", \"input-group\"], [\"formControlName\", \"number\", \"type\", \"number\", \"id\", \"numberOfSeats\", \"name\", \"numberOfSeats\", \"placeholder\", \"Number of Seats\", 1, \"form-control\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"fas\", \"fa-ticket\"], [\"class\", \"invalid-feedback d-block\", 4, \"ngIf\"], [2, \"text-decoration\", \"line-through\", \"font-weight\", \"100\", \"font-size\", \"14px\"], [2, \"font-weight\", \"bolder\", \"font-size\", \"18px\"], [1, \"invalid-feedback\", \"d-block\"], [1, \"popup-overlay\"], [1, \"card-insertion-popup\"], [1, \"form-group\"], [\"for\", \"cardNumber\"], [\"type\", \"text\", \"id\", \"cardNumber\", \"placeholder\", \"Enter card number\", \"required\", \"\", 1, \"form-control\"], [1, \"invalid-feedback\"], [\"for\", \"expiryDate\"], [\"type\", \"text\", \"id\", \"expiryDate\", \"placeholder\", \"MM/YY\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"cvv\"], [\"type\", \"text\", \"id\", \"cvv\", \"placeholder\", \"CVV\", \"required\", \"\", 1, \"form-control\"], [1, \"form-group\", \"text-center\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"btn\", \"btn-secondary\", 3, \"click\"]],\n    template: function MyBookingsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"head\");\n        i0.ɵɵelementStart(1, \"h5\", 0);\n        i0.ɵɵtext(2, \"My Tickets\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(3, MyBookingsComponent_div_3_Template, 53, 22, \"div\", 1);\n        i0.ɵɵtemplate(4, MyBookingsComponent_div_4_Template, 28, 3, \"div\", 2);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.bookings);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showReturnPopup);\n      }\n    },\n    directives: [i4.NgForOf, i4.NgIf, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.NgControlStatus, i3.FormControlName],\n    pipes: [i4.DatePipe, i4.CurrencyPipe],\n    styles: [\".blur-background[_ngcontent-%COMP%]{filter:blur(5px)}.no-scroll[_ngcontent-%COMP%]{overflow:hidden}.popup-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:9999}.card-insertion-popup[_ngcontent-%COMP%]{background:white;padding:20px;border-radius:10px;box-shadow:0 4px 8px #0003;width:90%;max-width:400px}.card-insertion-popup[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:20px}.card-insertion-popup[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}\"]\n  });\n  return MyBookingsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}